#!/bin/sh

if [ "$ALLOW_WORKFLOW_COMMIT" = "1" ]; then
  exit 0
fi

if git diff --cached --name-only | grep -q '^\.github/workflows/'; then
  echo ""
  echo "❌ Commit bloqué: changement détecté dans .github/workflows/*"
  echo "Ton auth actuelle ne peut pas push ces fichiers (scope workflow manquant)."
  echo ""
  echo "Retire le fichier du commit puis recommit :"
  echo "  git reset .github/workflows/ci.yml"
  echo "  git commit --amend --no-edit"
  echo ""
  echo "Override ponctuel (si tu sais ce que tu fais) :"
  echo "  ALLOW_WORKFLOW_COMMIT=1 git commit ..."
  echo ""
  exit 1
fi

exit 0